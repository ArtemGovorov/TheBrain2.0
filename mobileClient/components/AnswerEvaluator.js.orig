import React from 'react'
import { Text, View, TouchableWithoutFeedback } from 'react-native'
import { connect } from 'react-redux'
import { compose, graphql } from 'react-apollo'
import LinearGradient from 'react-native-linear-gradient'
import * as Animatable from 'react-native-animatable'

import SwipeBall from './SwipeBall'
<<<<<<< HEAD
import LevelUpWrapper from './LevelUpWrapper'
import Tutorial from './Tutorial'
import CasualQuestionModal from './CasualQuestionModal'
import userDetailsQuery from '../shared/graphql/queries/userDetails'
import { updateAnswerVisibility } from '../actions/FlashcardActions'
=======
import Triangle from './Triangle'
>>>>>>> 908a8910044c056567238a018f20233257500ea6

import styles from '../styles/styles'
import WithData from './WithData'

console.disableYellowBox = true

class AnswerEvaluator extends React.Component {
  overlayPress = () => {
    this.props.dispatch(updateAnswerVisibility(true))
  }

  render () {
    if (this.props.userDetails.loading) {
      return <View />
    }

    return (
<<<<<<< HEAD
      <Animatable.View style={[styles.answerEvaluator, {height: this.props.getAnswerEvaluatorHeight()}]} animation='slideInUp'>
=======
      <Animatable.View style={styles.answerEvaluator} animation='slideInUp'>
        <Triangle animated={this.props.enabled} line="top" style={styles.triangleTop}/>
>>>>>>> 908a8910044c056567238a018f20233257500ea6
        <LinearGradient
          style={styles.answerTopLine}
          colors={['#71b9d3', '#b3b3b3']}
          start={{x: 0, y: 0}}
          end={{x: 0, y: 1}}
        />
        <Triangle animated={this.props.enabled} line="right" style={styles.triangleRight}/>
        <LinearGradient
          style={styles.answerRightLine}
          colors={['#ff8533', '#b3b3b3']}
          start={{x: 1, y: 0}}
          end={{x: 0, y: 0}}
        />
        <Triangle animated={this.props.enabled} line="bottom" style={styles.triangleBottom}/>
        <LinearGradient
          style={styles.answerBottomLine}
          colors={['#c1272d', '#b3b3b3']}
          start={{x: 0, y: 1}}
          end={{x: 0, y: 0}}
        />
        <Triangle animated={this.props.enabled} line="left" style={styles.triangleLeft}/>
        <LinearGradient
          style={styles.answerLeftLine}
          colors={['#62c46c', '#b3b3b3']}
          start={{x: 0, y: 0}}
          end={{x: 1, y: 0}}
        />
        <View style={styles.answerFieldTop}>
          <Text style={styles.answerText}>Easy</Text>
        </View>
        <View style={styles.answerFieldRight}>
          <Text style={[styles.answerText, { transform: [{ rotate: '90deg' }] }]}>Good</Text>
        </View>
        <View style={styles.answerFieldBottom}>
          <Text style={styles.answerText}>No clue</Text>
        </View>
        <View style={styles.answerFieldLeft}>
          <Text style={[styles.answerText, { transform: [{ rotate: '-90deg' }] }]}>Wrong</Text>
        </View>
        <View style={styles.answerCircle} />
        <SwipeBall evalItemId={this.props.evalItemId} />

<<<<<<< HEAD
        {!this.props.enabled && <TouchableWithoutFeedback onPress={this.overlayPress}>
          <View style={styles.answerEvaluatorOverlay}/></TouchableWithoutFeedback>}
        {this.props.enabled && <Tutorial/>}
        {!this.props.enabled && this.props.userDetails.UserDetails.isCasual === null && <CasualQuestionModal/>}
=======
        {!this.props.enabled && <View style={styles.answerEvaluatorOverlay} />}

        {this.props.enabled && !hasDisabledTutorial && this.state.showTutorial &&
        <View style={styles.answerEvaluatorOverlay}>
          <Text style={styles.infoText}>How would you describe experience answering this question?</Text>
          <Text style={styles.infoText}>
            Rate using one of the four answers.{'\n'}
            Just slide your finger from the center circle to correct button.
          </Text>
          <View style={{ flexDirection: 'row' }}>
            <Text
              onPress={this.hideTutorial}
              style={[styles.button, { backgroundColor: '#62c46c' }]}
            >OK, go on</Text>
            <Text
              onPress={this.hideTutorialPermanently}
              style={[styles.button, { backgroundColor: '#662d91', marginLeft: 5 }]}
            >OK, go on. Don't show it again</Text>
          </View>
        </View>
        }
>>>>>>> 908a8910044c056567238a018f20233257500ea6
      </Animatable.View>
    )
  }
}

export default compose(
  connect(),
  graphql(userDetailsQuery, {
    name: 'userDetails'
  }),
  LevelUpWrapper
)(connect(state => state)(WithData(AnswerEvaluator, ['userDetails'])))
